When a program calls a function such as printf, it pushes the return address onto the stack before transferring control to the function. The return address is the address in the program's code that the function should return to when it is finished executing.

In a format string vulnerability, the attacker can use the %n specifier in a format string to write a value to a specific memory location. If the attacker can control the value of the argument passed to the %n specifier, they can use it to write to an arbitrary location in memory, including the return address on the stack.

Therefore, if you use a format string payload with the %n specifier to overwrite the return address on the stack, you are effectively overwriting the address that the printf function should return to when it is finished executing. This allows you to redirect program execution to a different location in the code, such as the first gadget in a ROP chain.

## How to exploit the format string vuln to execute arbitrary code  
A format string vulnerability occurs when the program uses printf() or a similar function to print a string that includes format specifiers, and the format string is controlled by the user. By carefully crafting the format string, you may be able to write to arbitrary memory addresses and execute code.

To exploit a format string vulnerability to execute arbitrary code, you can follow these steps:

Identify the vulnerable printf() call in the binary. You can do this by examining the disassembly of the binary and looking for calls to printf() or similar functions that take a format string as an argument.

Determine the layout of the stack at the time of the vulnerable printf() call. You can do this by examining the function's disassembly and identifying the locations on the stack where arguments and local variables are stored.

Use format specifiers in the format string to leak the value of a memory address. You can do this by using a format specifier such as %p or %n to print the value of a memory address.

Use the leaked value to calculate the address of the return address on the stack. You can do this by subtracting the offset to the return address from the leaked value.

Overwrite the return address with the address of your injected code. You can try injecting a simple piece of code, such as system("/bin/sh"), into the binary and finding its address using a disassembler or a debugger.

Send the payload and verify that your code has been executed. You can try running the program with a debugger attached to see if your injected code is being executed.
